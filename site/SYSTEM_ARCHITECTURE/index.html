
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Internal documentation for MOC-IoT device management system" name="description"/>
<meta content="MOC-IoT Engineering Team" name="author"/>
<link href="https://docs.moc-iot.com/SYSTEM_ARCHITECTURE/" rel="canonical"/>
<link href=".." rel="prev"/>
<link href="../DATA_FLOW_GUIDE/" rel="next"/>
<link href="../../assets/favicon.ico" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.18" name="generator"/>
<title>System Overview - MOC-IoT Documentation</title>
<link href="../assets/stylesheets/main.7e37652d.min.css" rel="stylesheet"/>
<link href="../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<!-- Custom authentication integration -->
<script src="../js/auth.js"></script>
<script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
</head>
<body data-md-color-accent="blue" data-md-color-primary="blue" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#iot-device-management-system-architecture-security">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="MOC-IoT Documentation" class="md-header__button md-logo" data-md-component="logo" href=".." title="MOC-IoT Documentation">
<img alt="logo" src="../../assets/logo.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            MOC-IoT Documentation
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              System Overview
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="blue" data-md-color-media="" data-md-color-primary="blue" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="blue" data-md-color-media="" data-md-color-primary="blue" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<a aria-label="Share" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="Share">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
</a>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/MOC-IoT/docs" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4" fill="currentColor"></path></svg>
</div>
<div class="md-source__repository">
    MOC-IoT/docs
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="..">
        
  
  
    
  
  Home

      </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="./">
          
  
  
  Architecture

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../api/edge-function/">
          
  
  
  API Documentation

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../FLYIO_SETUP/">
          
  
  
  Operations

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../DEVELOPMENT_GUIDE/">
          
  
  
  Development

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../reference/environment/">
          
  
  
  Reference

        </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="MOC-IoT Documentation" class="md-nav__button md-logo" data-md-component="logo" href=".." title="MOC-IoT Documentation">
<img alt="logo" src="../../assets/logo.png"/>
</a>
    MOC-IoT Documentation
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/MOC-IoT/docs" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4" fill="currentColor"></path></svg>
</div>
<div class="md-source__repository">
    MOC-IoT/docs
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="..">
<span class="md-ellipsis">
    Home
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
<span class="md-ellipsis">
    Architecture
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Architecture
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    System Overview
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    System Overview
    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#overview">
<span class="md-ellipsis">
      Overview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#system-architecture">
<span class="md-ellipsis">
      System Architecture
    </span>
</a>
<nav aria-label="System Architecture" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#system-architecture-diagram">
<span class="md-ellipsis">
      System Architecture Diagram
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#data-flow-sequence">
<span class="md-ellipsis">
      Data Flow Sequence
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#security-architecture">
<span class="md-ellipsis">
      Security Architecture
    </span>
</a>
<nav aria-label="Security Architecture" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-hmac-hash-based-message-authentication-code">
<span class="md-ellipsis">
      1. HMAC (Hash-based Message Authentication Code)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-x-signature-header-format">
<span class="md-ellipsis">
      2. X-Signature Header Format
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-security-layers">
<span class="md-ellipsis">
      3. Security Layers
    </span>
</a>
<nav aria-label="3. Security Layers" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#layer-1-network-security">
<span class="md-ellipsis">
      Layer 1: Network Security
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#layer-2-authentication-authorization">
<span class="md-ellipsis">
      Layer 2: Authentication &amp; Authorization
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#layer-3-data-validation">
<span class="md-ellipsis">
      Layer 3: Data Validation
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-by-step-workflows">
<span class="md-ellipsis">
      Step-by-Step Workflows
    </span>
</a>
<nav aria-label="Step-by-Step Workflows" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#workflow-1-sensor-data-ingestion-via-flyio-edge-function">
<span class="md-ellipsis">
      Workflow 1: Sensor Data Ingestion (via Fly.io → Edge Function)
    </span>
</a>
<nav aria-label="Workflow 1: Sensor Data Ingestion (via Fly.io → Edge Function)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#prerequisites">
<span class="md-ellipsis">
      Prerequisites
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-by-step-process">
<span class="md-ellipsis">
      Step-by-Step Process
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#updated-sequence-diagrams">
<span class="md-ellipsis">
      Updated Sequence Diagrams
    </span>
</a>
<nav aria-label="Updated Sequence Diagrams" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#sensor-data-flow-via-flyio">
<span class="md-ellipsis">
      Sensor Data Flow (via Fly.io)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#workflow-2-other-sensor-data-temperature-humidity-etc">
<span class="md-ellipsis">
      Workflow 2: Other Sensor Data (Temperature, Humidity, etc.)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#workflow-3-coap-data-ingestion-python-server">
<span class="md-ellipsis">
      Workflow 3: CoAP Data Ingestion (Python Server)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#workflow-4-user-authentication-authorization">
<span class="md-ellipsis">
      Workflow 4: User Authentication &amp; Authorization
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#database-schema-security">
<span class="md-ellipsis">
      Database Schema &amp; Security
    </span>
</a>
<nav aria-label="Database Schema &amp; Security" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#row-level-security-rls-policies">
<span class="md-ellipsis">
      Row Level Security (RLS) Policies
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#real-time-subscriptions">
<span class="md-ellipsis">
      Real-time Subscriptions
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#security-best-practices-implemented">
<span class="md-ellipsis">
      Security Best Practices Implemented
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#extending-the-system">
<span class="md-ellipsis">
      Extending the System
    </span>
</a>
<nav aria-label="Extending the System" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adding-new-sensor-types">
<span class="md-ellipsis">
      Adding New Sensor Types
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-adding-air-quality-sensor">
<span class="md-ellipsis">
      Example: Adding Air Quality Sensor
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#testing-debugging">
<span class="md-ellipsis">
      Testing &amp; Debugging
    </span>
</a>
<nav aria-label="Testing &amp; Debugging" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#hmac-signature-testing">
<span class="md-ellipsis">
      HMAC Signature Testing
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#monitoring-logs">
<span class="md-ellipsis">
      Monitoring &amp; Logs
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#future-enhancements">
<span class="md-ellipsis">
      Future Enhancements
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../DATA_FLOW_GUIDE/">
<span class="md-ellipsis">
    Data Flow
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    API Documentation
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            API Documentation
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/edge-function/">
<span class="md-ellipsis">
    Edge Function API
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/flyio-coap/">
<span class="md-ellipsis">
    Fly.io CoAP Interface
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/schemas/">
<span class="md-ellipsis">
    Data Schemas
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    Operations
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Operations
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../FLYIO_SETUP/">
<span class="md-ellipsis">
    Deployment
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../operations/monitoring/">
<span class="md-ellipsis">
    Monitoring
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../operations/troubleshooting/">
<span class="md-ellipsis">
    Troubleshooting
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    Development
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            Development
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../DEVELOPMENT_GUIDE/">
<span class="md-ellipsis">
    Local Setup
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../development/testing/">
<span class="md-ellipsis">
    Testing
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../development/contributing/">
<span class="md-ellipsis">
    Contributing
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
<span class="md-ellipsis">
    Reference
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            Reference
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../reference/environment/">
<span class="md-ellipsis">
    Environment Variables
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../reference/database/">
<span class="md-ellipsis">
    Database Schema
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../reference/changelog/">
<span class="md-ellipsis">
    Change Log
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#overview">
<span class="md-ellipsis">
      Overview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#system-architecture">
<span class="md-ellipsis">
      System Architecture
    </span>
</a>
<nav aria-label="System Architecture" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#system-architecture-diagram">
<span class="md-ellipsis">
      System Architecture Diagram
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#data-flow-sequence">
<span class="md-ellipsis">
      Data Flow Sequence
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#security-architecture">
<span class="md-ellipsis">
      Security Architecture
    </span>
</a>
<nav aria-label="Security Architecture" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-hmac-hash-based-message-authentication-code">
<span class="md-ellipsis">
      1. HMAC (Hash-based Message Authentication Code)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-x-signature-header-format">
<span class="md-ellipsis">
      2. X-Signature Header Format
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-security-layers">
<span class="md-ellipsis">
      3. Security Layers
    </span>
</a>
<nav aria-label="3. Security Layers" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#layer-1-network-security">
<span class="md-ellipsis">
      Layer 1: Network Security
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#layer-2-authentication-authorization">
<span class="md-ellipsis">
      Layer 2: Authentication &amp; Authorization
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#layer-3-data-validation">
<span class="md-ellipsis">
      Layer 3: Data Validation
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-by-step-workflows">
<span class="md-ellipsis">
      Step-by-Step Workflows
    </span>
</a>
<nav aria-label="Step-by-Step Workflows" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#workflow-1-sensor-data-ingestion-via-flyio-edge-function">
<span class="md-ellipsis">
      Workflow 1: Sensor Data Ingestion (via Fly.io → Edge Function)
    </span>
</a>
<nav aria-label="Workflow 1: Sensor Data Ingestion (via Fly.io → Edge Function)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#prerequisites">
<span class="md-ellipsis">
      Prerequisites
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-by-step-process">
<span class="md-ellipsis">
      Step-by-Step Process
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#updated-sequence-diagrams">
<span class="md-ellipsis">
      Updated Sequence Diagrams
    </span>
</a>
<nav aria-label="Updated Sequence Diagrams" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#sensor-data-flow-via-flyio">
<span class="md-ellipsis">
      Sensor Data Flow (via Fly.io)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#workflow-2-other-sensor-data-temperature-humidity-etc">
<span class="md-ellipsis">
      Workflow 2: Other Sensor Data (Temperature, Humidity, etc.)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#workflow-3-coap-data-ingestion-python-server">
<span class="md-ellipsis">
      Workflow 3: CoAP Data Ingestion (Python Server)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#workflow-4-user-authentication-authorization">
<span class="md-ellipsis">
      Workflow 4: User Authentication &amp; Authorization
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#database-schema-security">
<span class="md-ellipsis">
      Database Schema &amp; Security
    </span>
</a>
<nav aria-label="Database Schema &amp; Security" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#row-level-security-rls-policies">
<span class="md-ellipsis">
      Row Level Security (RLS) Policies
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#real-time-subscriptions">
<span class="md-ellipsis">
      Real-time Subscriptions
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#security-best-practices-implemented">
<span class="md-ellipsis">
      Security Best Practices Implemented
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#extending-the-system">
<span class="md-ellipsis">
      Extending the System
    </span>
</a>
<nav aria-label="Extending the System" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adding-new-sensor-types">
<span class="md-ellipsis">
      Adding New Sensor Types
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-adding-air-quality-sensor">
<span class="md-ellipsis">
      Example: Adding Air Quality Sensor
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#testing-debugging">
<span class="md-ellipsis">
      Testing &amp; Debugging
    </span>
</a>
<nav aria-label="Testing &amp; Debugging" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#hmac-signature-testing">
<span class="md-ellipsis">
      HMAC Signature Testing
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#monitoring-logs">
<span class="md-ellipsis">
      Monitoring &amp; Logs
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#future-enhancements">
<span class="md-ellipsis">
      Future Enhancements
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="iot-device-management-system-architecture-security">IoT Device Management System - Architecture &amp; Security<a class="headerlink" href="#iot-device-management-system-architecture-security" title="Permanent link">¶</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">¶</a></h2>
<p>This system handles IoT device data ingestion, processing, and real-time monitoring through multiple channels with robust security mechanisms.</p>
<h2 id="system-architecture">System Architecture<a class="headerlink" href="#system-architecture" title="Permanent link">¶</a></h2>
<h3 id="system-architecture-diagram">System Architecture Diagram<a class="headerlink" href="#system-architecture-diagram" title="Permanent link">¶</a></h3>
<pre class="mermaid"><code>flowchart TD
    A[IoT Device] --&gt;|CoAP/UDP| B[Fly.io Server]
    B --&gt;|HTTP/HTTPS + HMAC| C[Supabase Edge Function&lt;br/&gt;ingest-sensor-data]

    C --&gt; D{Data Type}
    D --&gt;|Location Data| E[HERE Positioning API]
    D --&gt;|Other Sensors| F[Direct Processing]

    E --&gt; G[Supabase Database]
    F --&gt; G

    G --&gt; H[Real-time Updates&lt;br/&gt;WebSocket Subscriptions]
    H --&gt; I[Frontend Dashboard]

    G --&gt; J[(Tables)]
    J --&gt; K[device_config]
    J --&gt; L[sensor_data]
    J --&gt; M[activity]
    J --&gt; N[reboot]

    I --&gt; O[Device List &amp; Filters]
    I --&gt; P[Interactive Map]
    I --&gt; Q[Real-time Monitoring]
    I --&gt; R[User Management]</code></pre>
<h3 id="data-flow-sequence">Data Flow Sequence<a class="headerlink" href="#data-flow-sequence" title="Permanent link">¶</a></h3>
<pre class="mermaid"><code>sequenceDiagram
    participant Device as IoT Device
    participant Fly as Fly.io Server
    participant Edge as Edge Function
    participant HERE as HERE API
    participant DB as Supabase DB
    participant UI as Frontend

    Note over Device, UI: Location Data Flow
    Device-&gt;&gt;Fly: CoAP/UDP: location payload
    Fly-&gt;&gt;Edge: POST /ingest-sensor-data&lt;br/&gt;+ HMAC signature
    Edge-&gt;&gt;Edge: Verify HMAC

    alt WiFi/Cell Data Available
        Edge-&gt;&gt;HERE: Position request
        HERE--&gt;&gt;Edge: Coordinates + accuracy
    else GNSS Data Only
        Edge-&gt;&gt;HERE: Process raw GNSS
        HERE--&gt;&gt;Edge: Calculated position
    end

    Edge-&gt;&gt;DB: INSERT sensor_data&lt;br/&gt;type: location
    DB--&gt;&gt;UI: Real-time update
    UI-&gt;&gt;UI: Update map markers

    Note over Device, UI: Other Sensor Data Flow  
    Device-&gt;&gt;Fly: CoAP/UDP: soil sensor payload&lt;br/&gt;(temp, humidity, NPK, pH, etc.)
    Fly-&gt;&gt;Edge: POST /ingest-sensor-data&lt;br/&gt;+ HMAC signature
    Edge-&gt;&gt;Edge: Verify HMAC
    Edge-&gt;&gt;DB: INSERT sensor_data&lt;br/&gt;type: soil_data&lt;br/&gt;data: {temp, humidity, npk, ph}
    DB--&gt;&gt;UI: Real-time updates
    UI-&gt;&gt;UI: Update dashboards</code></pre>
<h2 id="security-architecture">Security Architecture<a class="headerlink" href="#security-architecture" title="Permanent link">¶</a></h2>
<h3 id="1-hmac-hash-based-message-authentication-code">1. HMAC (Hash-based Message Authentication Code)<a class="headerlink" href="#1-hmac-hash-based-message-authentication-code" title="Permanent link">¶</a></h3>
<p><strong>What is HMAC?</strong>
- HMAC is a cryptographic mechanism that provides both data integrity and authenticity
- It combines a secret key with the message content to create a unique signature
- Uses SHA-256 hashing algorithm in our implementation</p>
<p><strong>How it works in our system:</strong></p>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-0-1"><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="c1">// Signature Generation (Client/Device side)</span>
</span><span id="__span-0-2"><a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">secret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"FLY_INGEST_SECRET"</span>
</span><span id="__span-0-3"><a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">messageBody</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span>
</span><span id="__span-0-4"><a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="kd">const</span><span class="w"> </span><span class="nx">signature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">hmac_sha256</span><span class="p">(</span><span class="nx">secret</span><span class="p">,</span><span class="w"> </span><span class="nx">messageBody</span><span class="p">)</span>
</span><span id="__span-0-5"><a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="kd">const</span><span class="w"> </span><span class="nx">hexSignature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">signature</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s1">'hex'</span><span class="p">)</span>
</span><span id="__span-0-6"><a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a>
</span><span id="__span-0-7"><a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="c1">// HTTP Header</span>
</span><span id="__span-0-8"><a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="nx">X</span><span class="o">-</span><span class="nx">Signature</span><span class="o">:</span><span class="w"> </span><span class="nx">sha256</span><span class="o">=</span><span class="nx">$</span><span class="p">{</span><span class="nx">hexSignature</span><span class="p">}</span>
</span></code></pre></div>
<p><strong>Verification Process:</strong>
1. Client calculates HMAC-SHA256 of the request body using shared secret
2. Client sends the signature in the <code>X-Signature</code> header
3. Server receives the request and extracts the signature
4. Server recalculates HMAC-SHA256 of the received body using the same secret
5. Server compares calculated signature with received signature
6. Request is accepted only if signatures match exactly</p>
<h3 id="2-x-signature-header-format">2. X-Signature Header Format<a class="headerlink" href="#2-x-signature-header-format" title="Permanent link">¶</a></h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a>X-Signature: sha256=&lt;hex_encoded_hmac_sha256_signature&gt;
</span></code></pre></div>
<p><strong>Example:</strong>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a>X-Signature: sha256=a3d2c1b4e5f6789abc123def456789abc123def456789abc123def456789abc123
</span></code></pre></div></p>
<h3 id="3-security-layers">3. Security Layers<a class="headerlink" href="#3-security-layers" title="Permanent link">¶</a></h3>
<h4 id="layer-1-network-security">Layer 1: Network Security<a class="headerlink" href="#layer-1-network-security" title="Permanent link">¶</a></h4>
<ul>
<li><strong>HTTPS/TLS</strong>: All HTTP communications are encrypted</li>
<li><strong>HMAC Verification</strong>: Prevents tampering and unauthorized requests</li>
<li><strong>Content-Type Validation</strong>: Only accepts <code>application/json</code></li>
</ul>
<h4 id="layer-2-authentication-authorization">Layer 2: Authentication &amp; Authorization<a class="headerlink" href="#layer-2-authentication-authorization" title="Permanent link">¶</a></h4>
<ul>
<li><strong>JWT Tokens</strong>: User authentication via Supabase Auth</li>
<li><strong>Row Level Security (RLS)</strong>: Database-level access control</li>
<li><strong>Role-based Access</strong>: Admin, Moderator, User roles with different permissions</li>
</ul>
<h4 id="layer-3-data-validation">Layer 3: Data Validation<a class="headerlink" href="#layer-3-data-validation" title="Permanent link">¶</a></h4>
<ul>
<li><strong>Schema Validation</strong>: JSON payloads validated against expected structure</li>
<li><strong>Input Sanitization</strong>: All inputs cleaned and validated</li>
<li><strong>Rate Limiting</strong>: Built-in Supabase edge function rate limiting</li>
</ul>
<h2 id="step-by-step-workflows">Step-by-Step Workflows<a class="headerlink" href="#step-by-step-workflows" title="Permanent link">¶</a></h2>
<h3 id="workflow-1-sensor-data-ingestion-via-flyio-edge-function">Workflow 1: Sensor Data Ingestion (via Fly.io → Edge Function)<a class="headerlink" href="#workflow-1-sensor-data-ingestion-via-flyio-edge-function" title="Permanent link">¶</a></h3>
<h4 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">¶</a></h4>
<ul>
<li>Device configured to send CoAP messages to Fly.io</li>
<li>Fly.io configured with shared secret (<code>FLY_INGEST_SECRET</code>)</li>
<li>HERE API key configured in Supabase secrets (for location data)</li>
</ul>
<h4 id="step-by-step-process">Step-by-Step Process<a class="headerlink" href="#step-by-step-process" title="Permanent link">¶</a></h4>
<ol>
<li>
<p><strong>Device Sends CoAP Message</strong>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-3-1"><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">payload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-2"><a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="w">  </span><span class="nx">devid</span><span class="o">:</span><span class="w"> </span><span class="s2">"device_001"</span><span class="p">,</span>
</span><span id="__span-3-3"><a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="w">  </span><span class="nx">wifi</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-3-4"><a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">mac</span><span class="o">:</span><span class="w"> </span><span class="s2">"AA:BB:CC:DD:EE:FF"</span><span class="p">,</span><span class="w"> </span><span class="nx">rssi</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">45</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-3-5"><a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">mac</span><span class="o">:</span><span class="w"> </span><span class="s2">"11:22:33:44:55:66"</span><span class="p">,</span><span class="w"> </span><span class="nx">rssi</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">67</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-3-6"><a href="#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-3-7"><a href="#__codelineno-3-7" id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="w">  </span><span class="nx">cells</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-3-8"><a href="#__codelineno-3-8" id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">mcc</span><span class="o">:</span><span class="w"> </span><span class="mf">310</span><span class="p">,</span><span class="w"> </span><span class="nx">mnc</span><span class="o">:</span><span class="w"> </span><span class="mf">410</span><span class="p">,</span><span class="w"> </span><span class="nx">lac</span><span class="o">:</span><span class="w"> </span><span class="mf">12345</span><span class="p">,</span><span class="w"> </span><span class="nx">cid</span><span class="o">:</span><span class="w"> </span><span class="mf">67890</span><span class="p">,</span><span class="w"> </span><span class="nx">rssi</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">78</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-3-9"><a href="#__codelineno-3-9" id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-3-10"><a href="#__codelineno-3-10" id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="w">  </span><span class="nx">gnss</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-11"><a href="#__codelineno-3-11" id="__codelineno-3-11" name="__codelineno-3-11"></a><span class="w">    </span><span class="nx">raw_satellite_data</span><span class="o">:</span><span class="w"> </span><span class="s2">"..."</span><span class="p">,</span><span class="w"> </span><span class="c1">// Raw GNSS measurements</span>
</span><span id="__span-3-12"><a href="#__codelineno-3-12" id="__codelineno-3-12" name="__codelineno-3-12"></a><span class="w">    </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="mf">1234567890</span>
</span><span id="__span-3-13"><a href="#__codelineno-3-13" id="__codelineno-3-13" name="__codelineno-3-13"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-3-14"><a href="#__codelineno-3-14" id="__codelineno-3-14" name="__codelineno-3-14"></a><span class="p">}</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Generate HMAC Signature</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="c1"># Using openssl (example)</span>
</span><span id="__span-4-2"><a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="nb">echo</span><span class="w"> </span>-n<span class="w"> </span><span class="s1">'{"devid":"device_001",...}'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>openssl<span class="w"> </span>dgst<span class="w"> </span>-sha256<span class="w"> </span>-hmac<span class="w"> </span><span class="s2">"your_secret_here"</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Fly.io Forwards to Edge Function</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="c1"># Fly.io automatically forwards to Supabase Edge Function</span>
</span><span id="__span-5-2"><a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>https://cdwtsrzshpotkfbyyyjk.supabase.co/functions/v1/ingest-sensor-data<span class="w"> </span><span class="se">\</span>
</span><span id="__span-5-3"><a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">"Content-Type: application/json"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-5-4"><a href="#__codelineno-5-4" id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">"X-Signature: sha256=calculated_signature_here"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-5-5"><a href="#__codelineno-5-5" id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="w">  </span>-d<span class="w"> </span><span class="s1">'{"devid":"device_001","wifi":[...],"cells":[...]}'</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Edge Function Processing</strong></p>
</li>
<li>Verify HMAC signature</li>
<li>Extract device ID and sensor data</li>
<li>
<p>Determine positioning method:</p>
<ul>
<li><strong>WiFi/Cell available</strong>: Call HERE Positioning API</li>
<li><strong>GNSS only</strong>: Process raw satellite data via HERE</li>
<li><strong>No location data</strong>: Skip positioning</li>
</ul>
</li>
<li>
<p><strong>HERE API Integration</strong>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-6-1"><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="c1">// WiFi/Cell positioning</span>
</span><span id="__span-6-2"><a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">'https://positioning.hereapi.com/v2/locate'</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-3"><a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="w">  </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">'POST'</span><span class="p">,</span>
</span><span id="__span-6-4"><a href="#__codelineno-6-4" id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="w">  </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s1">'Content-Type'</span><span class="o">:</span><span class="w"> </span><span class="s1">'application/json'</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-6-5"><a href="#__codelineno-6-5" id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="w">  </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
</span><span id="__span-6-6"><a href="#__codelineno-6-6" id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="w">    </span><span class="nx">wlan</span><span class="o">:</span><span class="w"> </span><span class="nx">formattedWifiData</span><span class="p">,</span>
</span><span id="__span-6-7"><a href="#__codelineno-6-7" id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="w">    </span><span class="nx">gsm</span><span class="o">:</span><span class="w"> </span><span class="nx">formattedCellData</span>
</span><span id="__span-6-8"><a href="#__codelineno-6-8" id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="w">  </span><span class="p">})</span>
</span><span id="__span-6-9"><a href="#__codelineno-6-9" id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="p">})</span>
</span><span id="__span-6-10"><a href="#__codelineno-6-10" id="__codelineno-6-10" name="__codelineno-6-10"></a>
</span><span id="__span-6-11"><a href="#__codelineno-6-11" id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="c1">// GNSS processing (if raw satellite data available)</span>
</span><span id="__span-6-12"><a href="#__codelineno-6-12" id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">'https://positioning.hereapi.com/v2/gnss'</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-13"><a href="#__codelineno-6-13" id="__codelineno-6-13" name="__codelineno-6-13"></a><span class="w">  </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">'POST'</span><span class="p">,</span>
</span><span id="__span-6-14"><a href="#__codelineno-6-14" id="__codelineno-6-14" name="__codelineno-6-14"></a><span class="w">  </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nx">gnssRawData</span>
</span><span id="__span-6-15"><a href="#__codelineno-6-15" id="__codelineno-6-15" name="__codelineno-6-15"></a><span class="p">})</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Database Storage</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-7-1"><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">sensor_data</span><span class="w"> </span><span class="p">(</span><span class="n">devid</span><span class="p">,</span><span class="w"> </span><span class="n">data_type</span><span class="p">,</span><span class="w"> </span><span class="k">data</span><span class="p">,</span><span class="w"> </span><span class="n">uplink_count</span><span class="p">)</span>
</span><span id="__span-7-2"><a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-7-3"><a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="w">  </span><span class="s1">'device_001'</span><span class="p">,</span>
</span><span id="__span-7-4"><a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="w">  </span><span class="s1">'location'</span><span class="p">,</span>
</span><span id="__span-7-5"><a href="#__codelineno-7-5" id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="w">  </span><span class="s1">'{"lat": 37.7749, "lng": -122.4194, "accuracy": 10, "source": "here"}'</span><span class="p">,</span>
</span><span id="__span-7-6"><a href="#__codelineno-7-6" id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="w">  </span><span class="mi">123</span>
</span><span id="__span-7-7"><a href="#__codelineno-7-7" id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="p">)</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Real-time Notification</strong></p>
</li>
<li>Supabase automatically notifies subscribed clients</li>
<li>Frontend receives real-time update</li>
<li>Map markers updated immediately</li>
</ol>
<h2 id="updated-sequence-diagrams">Updated Sequence Diagrams<a class="headerlink" href="#updated-sequence-diagrams" title="Permanent link">¶</a></h2>
<h3 id="sensor-data-flow-via-flyio">Sensor Data Flow (via Fly.io)<a class="headerlink" href="#sensor-data-flow-via-flyio" title="Permanent link">¶</a></h3>
<pre class="mermaid"><code>sequenceDiagram
    participant Device
    participant Fly as Fly.io Server
    participant EdgeFunc as Edge Function
    participant HERE as HERE Positioning API
    participant DB as Supabase Database
    participant Frontend

    Note over Device, Frontend: Geolocation Data Flow
    Device-&gt;&gt;Fly: CoAP/UDP: {wifi: [...], cells: [...], gnss: {raw satellite data}}
    Fly-&gt;&gt;EdgeFunc: POST /ingest-sensor-data&lt;br/&gt;{wifi: [...], cells: [...], gnss: {raw satellite data}}
    EdgeFunc-&gt;&gt;EdgeFunc: Verify HMAC signature

    alt Has WiFi/Cell data
        EdgeFunc-&gt;&gt;HERE: Request position with WiFi/Cell data
        HERE--&gt;&gt;EdgeFunc: {lat, lng, accuracy, source: "here"}
    else Has raw GNSS data only
        EdgeFunc-&gt;&gt;HERE: Process raw GNSS satellite data
        HERE--&gt;&gt;EdgeFunc: {lat, lng, accuracy, source: "gnss"}
    end

    EdgeFunc-&gt;&gt;DB: INSERT sensor_data&lt;br/&gt;{data_type: "location", data: {lat, lng, accuracy, source}}
    DB--&gt;&gt;Frontend: Real-time notification
    Frontend-&gt;&gt;Frontend: Update map markers

    Note over Device, Frontend: Other Sensor Data Flow
    Device-&gt;&gt;Fly: CoAP/UDP: {temperature: 23.5, soil_humidity: 65.2}
    Fly-&gt;&gt;EdgeFunc: POST /ingest-sensor-data&lt;br/&gt;{temperature: 23.5, soil_humidity: 65.2}
    EdgeFunc-&gt;&gt;EdgeFunc: Verify HMAC signature
    EdgeFunc-&gt;&gt;DB: INSERT sensor_data&lt;br/&gt;{data_type: "temperature", data: {value: 23.5, unit: "celsius"}}
    EdgeFunc-&gt;&gt;DB: INSERT sensor_data&lt;br/&gt;{data_type: "soil_humidity", data: {value: 65.2, unit: "percent"}}
    DB--&gt;&gt;Frontend: Real-time notifications
    Frontend-&gt;&gt;Frontend: Update sensor dashboards</code></pre>
<h3 id="workflow-2-other-sensor-data-temperature-humidity-etc">Workflow 2: Other Sensor Data (Temperature, Humidity, etc.)<a class="headerlink" href="#workflow-2-other-sensor-data-temperature-humidity-etc" title="Permanent link">¶</a></h3>
<ol>
<li>
<p><strong>Device Sends Sensor Data</strong>
<div class="language-json highlight"><pre><span></span><code><span id="__span-8-1"><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="p">{</span>
</span><span id="__span-8-2"><a href="#__codelineno-8-2" id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="w">  </span><span class="nt">"devid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"soil_sensor_001"</span><span class="p">,</span>
</span><span id="__span-8-3"><a href="#__codelineno-8-3" id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="w">  </span><span class="nt">"temperature"</span><span class="p">:</span><span class="w"> </span><span class="mf">23.5</span><span class="p">,</span>
</span><span id="__span-8-4"><a href="#__codelineno-8-4" id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="w">  </span><span class="nt">"soil_humidity"</span><span class="p">:</span><span class="w"> </span><span class="mf">65.2</span><span class="p">,</span>
</span><span id="__span-8-5"><a href="#__codelineno-8-5" id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="w">  </span><span class="nt">"ph_level"</span><span class="p">:</span><span class="w"> </span><span class="mf">6.8</span><span class="p">,</span>
</span><span id="__span-8-6"><a href="#__codelineno-8-6" id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="w">  </span><span class="nt">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="mi">1705123456</span>
</span><span id="__span-8-7"><a href="#__codelineno-8-7" id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="p">}</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Edge Function Processing</strong></p>
</li>
<li>Verify HMAC signature</li>
<li>Parse sensor readings</li>
<li>
<p>Create separate sensor_data entries for each measurement</p>
</li>
<li>
<p><strong>Multiple Database Inserts</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-9-1"><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">sensor_data</span><span class="w"> </span><span class="p">(</span><span class="n">devid</span><span class="p">,</span><span class="w"> </span><span class="n">data_type</span><span class="p">,</span><span class="w"> </span><span class="k">data</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span>
</span><span id="__span-9-2"><a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="p">(</span><span class="s1">'soil_sensor_001'</span><span class="p">,</span><span class="w"> </span><span class="s1">'temperature'</span><span class="p">,</span><span class="w"> </span><span class="s1">'{"value": 23.5, "unit": "celsius"}'</span><span class="p">),</span>
</span><span id="__span-9-3"><a href="#__codelineno-9-3" id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="p">(</span><span class="s1">'soil_sensor_001'</span><span class="p">,</span><span class="w"> </span><span class="s1">'soil_humidity'</span><span class="p">,</span><span class="w"> </span><span class="s1">'{"value": 65.2, "unit": "percent"}'</span><span class="p">),</span>
</span><span id="__span-9-4"><a href="#__codelineno-9-4" id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="p">(</span><span class="s1">'soil_sensor_001'</span><span class="p">,</span><span class="w"> </span><span class="s1">'ph_level'</span><span class="p">,</span><span class="w"> </span><span class="s1">'{"value": 6.8, "unit": "ph"}'</span><span class="p">)</span>
</span></code></pre></div></p>
</li>
</ol>
<h3 id="workflow-3-coap-data-ingestion-python-server">Workflow 3: CoAP Data Ingestion (Python Server)<a class="headerlink" href="#workflow-3-coap-data-ingestion-python-server" title="Permanent link">¶</a></h3>
<ol>
<li><strong>Device Connection</strong></li>
<li>Device connects to CoAP server on port 5683/UDP</li>
<li>
<p>Sends protobuf-encoded data to <code>/uplink</code> endpoint</p>
</li>
<li>
<p><strong>Python Server Processing</strong>
<div class="language-python highlight"><pre><span></span><code><span id="__span-10-1"><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="c1"># Parse protobuf message</span>
</span><span id="__span-10-2"><a href="#__codelineno-10-2" id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="n">uplink_data</span> <span class="o">=</span> <span class="n">parse_protobuf</span><span class="p">(</span><span class="n">coap_payload</span><span class="p">)</span>
</span><span id="__span-10-3"><a href="#__codelineno-10-3" id="__codelineno-10-3" name="__codelineno-10-3"></a>
</span><span id="__span-10-4"><a href="#__codelineno-10-4" id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="c1"># Extract different data types</span>
</span><span id="__span-10-5"><a href="#__codelineno-10-5" id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="n">device_config</span> <span class="o">=</span> <span class="n">extract_device_config</span><span class="p">(</span><span class="n">uplink_data</span><span class="p">)</span>
</span><span id="__span-10-6"><a href="#__codelineno-10-6" id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="n">activity_data</span> <span class="o">=</span> <span class="n">extract_activity</span><span class="p">(</span><span class="n">uplink_data</span><span class="p">)</span>
</span><span id="__span-10-7"><a href="#__codelineno-10-7" id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="n">reboot_data</span> <span class="o">=</span> <span class="n">extract_reboot_info</span><span class="p">(</span><span class="n">uplink_data</span><span class="p">)</span>
</span><span id="__span-10-8"><a href="#__codelineno-10-8" id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="n">sensor_readings</span> <span class="o">=</span> <span class="n">extract_sensor_data</span><span class="p">(</span><span class="n">uplink_data</span><span class="p">)</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Concurrent Database Operations</strong>
<div class="language-python highlight"><pre><span></span><code><span id="__span-11-1"><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
</span><span id="__span-11-2"><a href="#__codelineno-11-2" id="__codelineno-11-2" name="__codelineno-11-2"></a>    <span class="n">upsert_device_config</span><span class="p">(</span><span class="n">device_config</span><span class="p">),</span>
</span><span id="__span-11-3"><a href="#__codelineno-11-3" id="__codelineno-11-3" name="__codelineno-11-3"></a>    <span class="n">insert_activity</span><span class="p">(</span><span class="n">activity_data</span><span class="p">),</span>
</span><span id="__span-11-4"><a href="#__codelineno-11-4" id="__codelineno-11-4" name="__codelineno-11-4"></a>    <span class="n">insert_reboot</span><span class="p">(</span><span class="n">reboot_data</span><span class="p">),</span>
</span><span id="__span-11-5"><a href="#__codelineno-11-5" id="__codelineno-11-5" name="__codelineno-11-5"></a>    <span class="n">insert_sensor_data</span><span class="p">(</span><span class="n">sensor_readings</span><span class="p">)</span>
</span><span id="__span-11-6"><a href="#__codelineno-11-6" id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="p">)</span>
</span></code></pre></div></p>
</li>
</ol>
<h3 id="workflow-4-user-authentication-authorization">Workflow 4: User Authentication &amp; Authorization<a class="headerlink" href="#workflow-4-user-authentication-authorization" title="Permanent link">¶</a></h3>
<ol>
<li>
<p><strong>User Registration/Login</strong>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-12-1"><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">supabase</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">signInWithPassword</span><span class="p">({</span>
</span><span id="__span-12-2"><a href="#__codelineno-12-2" id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="w">  </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s1">'user@example.com'</span><span class="p">,</span>
</span><span id="__span-12-3"><a href="#__codelineno-12-3" id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="w">  </span><span class="nx">password</span><span class="o">:</span><span class="w"> </span><span class="s1">'secure_password'</span>
</span><span id="__span-12-4"><a href="#__codelineno-12-4" id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="p">})</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Automatic Profile Creation</strong></p>
</li>
<li>Database trigger creates profile entry</li>
<li>Assigns default 'user' role</li>
<li>
<p>Sets up initial permissions</p>
</li>
<li>
<p><strong>Role-based Access Control</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-13-1"><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="c1">-- Admin: Full access to all data</span>
</span><span id="__span-13-2"><a href="#__codelineno-13-2" id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="c1">-- Moderator: Can manage devices and sensor data</span>
</span><span id="__span-13-3"><a href="#__codelineno-13-3" id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="c1">-- User: Can only view devices they have access to</span>
</span><span id="__span-13-4"><a href="#__codelineno-13-4" id="__codelineno-13-4" name="__codelineno-13-4"></a>
</span><span id="__span-13-5"><a href="#__codelineno-13-5" id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">device_config</span><span class="w"> </span>
</span><span id="__span-13-6"><a href="#__codelineno-13-6" id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="k">WHERE</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-13-7"><a href="#__codelineno-13-7" id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">device_access</span><span class="w"> </span>
</span><span id="__span-13-8"><a href="#__codelineno-13-8" id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">auth</span><span class="p">.</span><span class="n">uid</span><span class="p">()</span><span class="w"> </span>
</span><span id="__span-13-9"><a href="#__codelineno-13-9" id="__codelineno-13-9" name="__codelineno-13-9"></a><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">devid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">device_config</span><span class="p">.</span><span class="n">devid</span>
</span><span id="__span-13-10"><a href="#__codelineno-13-10" id="__codelineno-13-10" name="__codelineno-13-10"></a><span class="p">)</span>
</span></code></pre></div></p>
</li>
</ol>
<h2 id="database-schema-security">Database Schema &amp; Security<a class="headerlink" href="#database-schema-security" title="Permanent link">¶</a></h2>
<h3 id="row-level-security-rls-policies">Row Level Security (RLS) Policies<a class="headerlink" href="#row-level-security-rls-policies" title="Permanent link">¶</a></h3>
<p><strong>device_config table:</strong>
- Admins/Moderators: Full access
- Users: Can only view devices they have access to (via device_access table)</p>
<p><strong>sensor_data table:</strong>
- Admins/Moderators: Full access
- Authenticated users: Read-only access to all sensor data</p>
<p><strong>user_roles table:</strong>
- Admins: Full access
- Users: Can only view their own roles</p>
<h3 id="real-time-subscriptions">Real-time Subscriptions<a class="headerlink" href="#real-time-subscriptions" title="Permanent link">¶</a></h3>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-14-1"><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="c1">// Frontend subscribes to real-time updates</span>
</span><span id="__span-14-2"><a href="#__codelineno-14-2" id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">subscription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">supabase</span>
</span><span id="__span-14-3"><a href="#__codelineno-14-3" id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="w">  </span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="s1">'sensor-updates'</span><span class="p">)</span>
</span><span id="__span-14-4"><a href="#__codelineno-14-4" id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="w">  </span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'postgres_changes'</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-5"><a href="#__codelineno-14-5" id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="w">    </span><span class="nx">event</span><span class="o">:</span><span class="w"> </span><span class="s1">'INSERT'</span><span class="p">,</span>
</span><span id="__span-14-6"><a href="#__codelineno-14-6" id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="w">    </span><span class="nx">schema</span><span class="o">:</span><span class="w"> </span><span class="s1">'public'</span><span class="p">,</span>
</span><span id="__span-14-7"><a href="#__codelineno-14-7" id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="w">    </span><span class="nx">table</span><span class="o">:</span><span class="w"> </span><span class="s1">'sensor_data'</span>
</span><span id="__span-14-8"><a href="#__codelineno-14-8" id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-9"><a href="#__codelineno-14-9" id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="w">    </span><span class="c1">// Update UI with new sensor data</span>
</span><span id="__span-14-10"><a href="#__codelineno-14-10" id="__codelineno-14-10" name="__codelineno-14-10"></a><span class="w">    </span><span class="nx">updateSensorDisplay</span><span class="p">(</span><span class="nx">payload</span><span class="p">.</span><span class="ow">new</span><span class="p">)</span>
</span><span id="__span-14-11"><a href="#__codelineno-14-11" id="__codelineno-14-11" name="__codelineno-14-11"></a><span class="w">  </span><span class="p">})</span>
</span><span id="__span-14-12"><a href="#__codelineno-14-12" id="__codelineno-14-12" name="__codelineno-14-12"></a><span class="w">  </span><span class="p">.</span><span class="nx">subscribe</span><span class="p">()</span>
</span></code></pre></div>
<h2 id="security-best-practices-implemented">Security Best Practices Implemented<a class="headerlink" href="#security-best-practices-implemented" title="Permanent link">¶</a></h2>
<ol>
<li><strong>Never store secrets in code</strong> - All sensitive data in Supabase secrets</li>
<li><strong>HMAC verification</strong> - Prevents unauthorized data injection</li>
<li><strong>HTTPS/TLS encryption</strong> - All network traffic encrypted</li>
<li><strong>Row Level Security</strong> - Database-level access control</li>
<li><strong>JWT authentication</strong> - Secure user sessions</li>
<li><strong>Input validation</strong> - All inputs sanitized and validated</li>
<li><strong>Rate limiting</strong> - Built-in protection against abuse</li>
<li><strong>Audit logging</strong> - All database changes logged with timestamps</li>
</ol>
<h2 id="extending-the-system">Extending the System<a class="headerlink" href="#extending-the-system" title="Permanent link">¶</a></h2>
<h3 id="adding-new-sensor-types">Adding New Sensor Types<a class="headerlink" href="#adding-new-sensor-types" title="Permanent link">¶</a></h3>
<ol>
<li><strong>Define new data_type</strong> in sensor_data table</li>
<li><strong>Update Edge Function</strong> to handle new sensor format</li>
<li><strong>Create Frontend Components</strong> to display new sensor data</li>
<li><strong>Add Real-time Subscriptions</strong> for immediate updates</li>
</ol>
<h3 id="example-adding-air-quality-sensor">Example: Adding Air Quality Sensor<a class="headerlink" href="#example-adding-air-quality-sensor" title="Permanent link">¶</a></h3>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-15-1"><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="c1">// Edge function handles new sensor type</span>
</span><span id="__span-15-2"><a href="#__codelineno-15-2" id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">payload</span><span class="p">.</span><span class="nx">air_quality</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-3"><a href="#__codelineno-15-3" id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">supabase</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="s1">'sensor_data'</span><span class="p">).</span><span class="nx">insert</span><span class="p">({</span>
</span><span id="__span-15-4"><a href="#__codelineno-15-4" id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="w">    </span><span class="nx">devid</span><span class="o">:</span><span class="w"> </span><span class="nx">payload</span><span class="p">.</span><span class="nx">devid</span><span class="p">,</span>
</span><span id="__span-15-5"><a href="#__codelineno-15-5" id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="w">    </span><span class="nx">data_type</span><span class="o">:</span><span class="w"> </span><span class="s1">'air_quality'</span><span class="p">,</span>
</span><span id="__span-15-6"><a href="#__codelineno-15-6" id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="w">    </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-7"><a href="#__codelineno-15-7" id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="w">      </span><span class="nx">pm25</span><span class="o">:</span><span class="w"> </span><span class="nx">payload</span><span class="p">.</span><span class="nx">air_quality</span><span class="p">.</span><span class="nx">pm25</span><span class="p">,</span>
</span><span id="__span-15-8"><a href="#__codelineno-15-8" id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="w">      </span><span class="nx">pm10</span><span class="o">:</span><span class="w"> </span><span class="nx">payload</span><span class="p">.</span><span class="nx">air_quality</span><span class="p">.</span><span class="nx">pm10</span><span class="p">,</span>
</span><span id="__span-15-9"><a href="#__codelineno-15-9" id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="w">      </span><span class="nx">co2</span><span class="o">:</span><span class="w"> </span><span class="nx">payload</span><span class="p">.</span><span class="nx">air_quality</span><span class="p">.</span><span class="nx">co2</span><span class="p">,</span>
</span><span id="__span-15-10"><a href="#__codelineno-15-10" id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="w">      </span><span class="nx">unit</span><span class="o">:</span><span class="w"> </span><span class="s1">'ppm'</span>
</span><span id="__span-15-11"><a href="#__codelineno-15-11" id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-15-12"><a href="#__codelineno-15-12" id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="w">  </span><span class="p">})</span>
</span><span id="__span-15-13"><a href="#__codelineno-15-13" id="__codelineno-15-13" name="__codelineno-15-13"></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="testing-debugging">Testing &amp; Debugging<a class="headerlink" href="#testing-debugging" title="Permanent link">¶</a></h2>
<h3 id="hmac-signature-testing">HMAC Signature Testing<a class="headerlink" href="#hmac-signature-testing" title="Permanent link">¶</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a href="#__codelineno-16-1" id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="c1"># Generate test signature</span>
</span><span id="__span-16-2"><a href="#__codelineno-16-2" id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="nv">SECRET</span><span class="o">=</span><span class="s2">"your_secret_here"</span>
</span><span id="__span-16-3"><a href="#__codelineno-16-3" id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="nv">PAYLOAD</span><span class="o">=</span><span class="s1">'{"devid":"test_device","temperature":25.0}'</span>
</span><span id="__span-16-4"><a href="#__codelineno-16-4" id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="nv">SIGNATURE</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">"</span><span class="nv">$PAYLOAD</span><span class="s2">"</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>openssl<span class="w"> </span>dgst<span class="w"> </span>-sha256<span class="w"> </span>-hmac<span class="w"> </span><span class="s2">"</span><span class="nv">$SECRET</span><span class="s2">"</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="s1">' '</span><span class="w"> </span>-f2<span class="k">)</span>
</span><span id="__span-16-5"><a href="#__codelineno-16-5" id="__codelineno-16-5" name="__codelineno-16-5"></a>
</span><span id="__span-16-6"><a href="#__codelineno-16-6" id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="c1"># Test API call</span>
</span><span id="__span-16-7"><a href="#__codelineno-16-7" id="__codelineno-16-7" name="__codelineno-16-7"></a>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>https://your-project.supabase.co/functions/v1/ingest-sensor-data<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-8"><a href="#__codelineno-16-8" id="__codelineno-16-8" name="__codelineno-16-8"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">"Content-Type: application/json"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-9"><a href="#__codelineno-16-9" id="__codelineno-16-9" name="__codelineno-16-9"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">"X-Signature: sha256=</span><span class="nv">$SIGNATURE</span><span class="s2">"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-10"><a href="#__codelineno-16-10" id="__codelineno-16-10" name="__codelineno-16-10"></a><span class="w">  </span>-d<span class="w"> </span><span class="s2">"</span><span class="nv">$PAYLOAD</span><span class="s2">"</span>
</span></code></pre></div>
<h3 id="monitoring-logs">Monitoring &amp; Logs<a class="headerlink" href="#monitoring-logs" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Edge Function Logs</strong>: Available in Supabase dashboard</li>
<li><strong>Database Logs</strong>: Query postgres_logs for database operations</li>
<li><strong>Real-time Debugging</strong>: Use browser dev tools to monitor WebSocket connections</li>
</ul>
<h2 id="future-enhancements">Future Enhancements<a class="headerlink" href="#future-enhancements" title="Permanent link">¶</a></h2>
<ol>
<li><strong>Device Authentication</strong>: Individual device certificates</li>
<li><strong>Data Encryption</strong>: End-to-end encryption for sensitive sensor data</li>
<li><strong>Advanced Analytics</strong>: Time-series analysis and predictions</li>
<li><strong>Mobile Apps</strong>: React Native apps for field technicians</li>
<li><strong>Alert System</strong>: Real-time notifications for anomalies</li>
<li><strong>Data Export</strong>: CSV/JSON export functionality</li>
<li><strong>Device Provisioning</strong>: Automated device onboarding</li>
</ol>
<aside class="md-source-file">
<span class="md-source-file__fact">
<span class="md-icon" title="Last update">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"></path></svg>
</span>
<span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="August 31, 2025 21:54:11 UTC">August 31, 2025</span>
</span>
<span class="md-source-file__fact">
<span class="md-icon" title="Created">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"></path></svg>
</span>
<span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="August 31, 2025 21:54:11 UTC">August 31, 2025</span>
</span>
</aside>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: Home" class="md-footer__link md-footer__link--prev" href="..">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</div>
<div class="md-footer__title">
<span class="md-footer__direction">
                Previous
              </span>
<div class="md-ellipsis">
                Home
              </div>
</div>
</a>
<a aria-label="Next: Data Flow" class="md-footer__link md-footer__link--next" href="../DATA_FLOW_GUIDE/">
<div class="md-footer__title">
<span class="md-footer__direction">
                Next
              </span>
<div class="md-ellipsis">
                Data Flow
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright © 2025 MOC-IoT Engineering Team
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://github.com/MOC-IoT" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2" fill="currentColor"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "navigation.path", "navigation.top", "search.highlight", "search.share", "content.code.copy", "content.code.annotate", "navigation.footer"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../assets/javascripts/bundle.92b07e13.min.js"></script>
</body>
</html>