# MOC-IoT Device Tracking System - Technical Documentation

Internal documentation for the MOC-IoT device tracking system. This serves as both a deployment guide and protocol reference for firmware and backend development.

## System Architecture

The MOC-IoT system uses a straightforward data pipeline:

```
IoT Devices → CoAP/UDP:5683 → Fly.io Python Server → HTTPS/HMAC → Supabase Edge Functions → PostgreSQL → React Dashboard
```

### Core Components

- **IoT Devices**: Send sensor data via CoAP over NB-IoT/LTE cellular networks using Protocol Buffers
- **CoAP Bridge**: Python 3.11 server on Fly.io processes CoAP messages and forwards to Supabase
- **Supabase Backend**: Edge functions handle data ingestion, PostgreSQL stores device data
- **React Dashboard**: Real-time monitoring interface built with TypeScript and shadcn-ui

## Quick Reference

### For Firmware Development
- [Protocol Specifications](/architecture/protocol-specs) - Protobuf message structures and CoAP endpoints
- [Development Guide](/development/firmware-guide) - Message construction and testing procedures

### For Backend Operations  
- [CoAP Bridge Deployment](/architecture/coap-bridge) - Fly.io deployment and monitoring
- [API Specifications](/api-docs/edge-function) - Supabase Edge Function interfaces
- [Database Schema](/reference/database-schema) - Table structures and relationships

### For Dashboard Development
- [Dashboard Integration](/architecture/dashboard) - React frontend architecture and real-time updates

## Technology Stack

### Communication Protocol
- **CoAP (UDP:5683)**: Lightweight protocol optimized for IoT devices
- **Protocol Buffers**: Efficient binary message serialization  
- **HMAC-SHA256**: Message authentication and integrity verification

### Infrastructure
- **Fly.io**: Container hosting for the CoAP bridge server
- **Supabase**: PostgreSQL database with Edge Functions and real-time subscriptions
- **NB-IoT/LTE**: Cellular connectivity for device communication

### Frontend
- **React 18** with TypeScript and Vite
- **shadcn-ui** components with Tailwind CSS
- **TanStack Query** for state management and caching
- **Leaflet** for interactive device location mapping

## Data Flow Overview

1. **Device Transmission**: IoT devices encode sensor data using Protocol Buffers and send via CoAP
2. **Bridge Processing**: Fly.io Python server receives CoAP messages, validates protobuf structure
3. **Data Forwarding**: Server converts to JSON and forwards to Supabase Edge Functions with HMAC signature
4. **Backend Processing**: Edge functions validate HMAC, process location data via HERE API, store in PostgreSQL
5. **Real-time Updates**: Supabase notifies dashboard clients via WebSocket subscriptions
6. **Dashboard Display**: React frontend updates device status, location markers, and sensor readings

## Getting Started

1. **Firmware Development**: Start with [Protocol Specifications](/architecture/protocol-specs) to understand message formats
2. **Backend Setup**: Review [CoAP Bridge Deployment](/architecture/coap-bridge) for server configuration
3. **Testing**: Use [Development Guide](/development/firmware-guide) for local testing procedures